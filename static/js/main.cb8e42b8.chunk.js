(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{21:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(23),c=a.n(r),i=(a(21),a(25)),s=a(1);var u=function(){return o.a.createElement("div",{className:"lds-ripple"},o.a.createElement("div",null),o.a.createElement("div",null))},l=o.a.createContext();var p=function(e){var t=e.loader,a=e.setLoader,n=e.onCardClick,r=e.onCardLike,c=e.onTrashClick,i=e.card,p=o.a.useState(!1),m=Object(s.a)(p,2),d=m[0],h=m[1];o.a.useEffect((function(){h(!1),a(!0)}),[t,a]);var f=o.a.useContext(l),_=i.owner._id===f._id,g="".concat(_?"photo-grid__trash-button":"photo-grid__trash-button_hidden"),b=i.likes.some((function(e){return e._id===f._id})),E="".concat(b?"liked":"");return o.a.createElement("figure",{className:"photo-grid__item"},o.a.createElement("button",{className:g,type:"button","aria-label":"\u0443\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(){c(i)}}),o.a.createElement("img",{src:i.link,alt:i.name,className:"photo-grid__image",onClick:function(){n(i)}}),o.a.createElement("div",{className:"photo-grid__data"},o.a.createElement("p",{className:"photo-grid__caption"},i.name),d?o.a.createElement(u,null):o.a.createElement("button",{className:"photo-grid__like-button ".concat(E),type:"button","aria-label":"\u043b\u0430\u0439\u043a",onClick:function(){r(i),h(!0)}},o.a.createElement("p",{className:"photo-grid__like-amount"},i.likes.length))))};var m=function(e){var t=o.a.useContext(l),a=t.avatar,n=t.name,r=t.about;return o.a.createElement("main",{className:"main"},o.a.createElement("section",{className:"profile"},o.a.createElement("figure",{className:"profile__figure"},o.a.createElement("div",{className:"profile__image",onClick:e.onEditAvatar,style:{backgroundImage:"url(".concat(a,")")}}),o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__title"},o.a.createElement("h1",{className:"profile__header"},n),o.a.createElement("button",{className:"profile__edit-button open-button",type:"button","aria-label":"\u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",onClick:e.onEditProfile})),o.a.createElement("p",{className:"profile__subheader"},r)),o.a.createElement("button",{className:"profile__add-button open-button",type:"button","aria-label":"\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c",onClick:e.onAddPlace}))),o.a.createElement("section",{className:"photo-grid"},e.cards.map((function(t){return o.a.createElement(p,{card:t,onCardClick:e.onCardClick,onTrashClick:e.onTrashClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete,key:t._id,loader:e.loader,setLoader:e.setLoader})}))))},d=a(2),h=a.p+"static/media/logo-mesto.a307e1c4.svg",f=a(6),_="jwt";var g=function(e){var t=Object(d.h)();return o.a.createElement("header",{className:"header"},o.a.createElement("img",{src:h,alt:"\u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0439 \u043b\u043e\u0433\u043e\u0442\u0438\u043f \xabMesto Russia\xbb",className:"header__logo"}),o.a.createElement("div",{className:"header__auth"},o.a.createElement("span",{className:"header__email"},e.loggedIn&&e.userData?e.userData.email:null),e.loggedIn?o.a.createElement(f.b,{className:"header__link",onClick:function(){localStorage.removeItem(_),e.setLoggedIn(!1)},to:"/signin"},"\u0412\u044b\u0439\u0442\u0438"):o.a.createElement(f.b,{className:"header__link",to:"/signin"===t.pathname?"/signup":"/signin"},"/signin"===t.pathname?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0412\u0445\u043e\u0434")))};var b=function(){return o.a.createElement("footer",{className:"footer"},o.a.createElement("p",{className:"footer__copyright"},"\xa92020. Mesto Russia"))},E=a(12),v=a(13),k="54532ad3-7188-4e99-8465-19f8ff7a677f",C=new(function(){function e(t){var a=t.baseURL,n=t.headers,o=t.method,r=void 0===o?"GET":o;Object(E.a)(this,e),this.baseURL=a,this.headers=n,this.method=r}return Object(v.a)(e,[{key:"getProfile",value:function(e){return fetch("".concat(this.baseURL).concat(e),{headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"getCards",value:function(e){return fetch("".concat(this.baseURL).concat(e),{headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"toggleLike",value:function(e,t){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"addUserCard",value:function(e,t,a,n){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers,body:JSON.stringify({name:a,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"deleteCard",value:function(e,t){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"editProfileInfo",value:function(e,t,a,n){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers,body:JSON.stringify({name:a,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}},{key:"setAvatar",value:function(e,t,a){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers,body:JSON.stringify({avatar:a})}).then((function(e){return e.ok?e.json():Promise.reject("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}}]),e}())({baseURL:"https://mesto.nomoreparties.co/v1/cohort-14",headers:{authorization:k,"Content-Type":"application/json"}}),N=new(function(){function e(t){var a=t.baseURL,n=t.headers,o=t.method,r=void 0===o?"GET":o;Object(E.a)(this,e),this.baseURL=a,this.headers=n,this.method=r}return Object(v.a)(e,[{key:"auth",value:function(e,t,a){return fetch("".concat(this.baseURL).concat(e),{method:t,headers:this.headers,body:JSON.stringify(a)}).then((function(e){return e.ok?e.json():e.json().then((function(t){return Promise.reject(t.error||"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}))}},{key:"getData",value:function(e,t){return fetch("".concat(this.baseURL).concat(e),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}).then((function(e){return e.ok?e.json():e.json().then((function(t){return Promise.reject(t.error||"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a: ".concat(e.status))}))}))}}]),e}())({baseURL:"https://auth.nomoreparties.co",headers:{authorization:k,Accept:"application/json","Content-Type":"application/json"}});var j=function(e){return o.a.createElement("div",{className:"popup popup_".concat(e.name," ").concat(e.isOpen?"popup_opened":"")},o.a.createElement("div",{className:"popup__container"},o.a.createElement("button",{className:"popup__close-button",type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}),o.a.createElement("h2",{className:"popup__header"},e.title),o.a.createElement("form",{onSubmit:e.onSubmit,className:"popup__form popup__".concat(e.name,"-form"),name:"popup-".concat(e.name,"-form"),method:"post",action:"#",noValidate:!0},e.children,e.buttonTitle&&o.a.createElement("button",{type:"submit",className:"popup__button"},e.buttonTitle))))};var O=function(e){var t=o.a.useContext(l),a=o.a.useState(""),n=Object(s.a)(a,2),r=n[0],c=n[1],i=o.a.useState(""),u=Object(s.a)(i,2),p=u[0],m=u[1];return o.a.useEffect((function(){c(t.name||""),m(t.about||"")}),[t]),o.a.createElement(j,{title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"edit",isOpen:e.isOpen,onClose:e.onClose,buttonTitle:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onSubmit:function(t){t.preventDefault(),e.onUpdateUser({about:p,name:r})}},o.a.createElement("input",{type:"text",value:r,onChange:function(e){c(e.target.value)},className:"popup__input popup__input_name",id:"name-input",minLength:"2",maxLength:"40",placeholder:"\u0418\u043c\u044f",required:!0,name:"popup-input-name"}),o.a.createElement("div",{className:"popup__input-error",id:"name-input-error"}),o.a.createElement("input",{type:"text",value:p,onChange:function(e){m(e.target.value)},className:"popup__input popup__input_job",id:"job-input",minLength:"2",maxLength:"200",placeholder:"\u0420\u043e\u0434 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438",required:!0,name:"popup-input-job"}),o.a.createElement("div",{className:"popup__input-error",id:"job-input-error"}))};var S=function(e){return o.a.createElement(j,{isOpen:e.isOpen,title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",name:"confirm",buttonTitle:"\u0414\u0430",onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onCardDelete(e.isOpen)}})};var L=function(e){var t=o.a.useRef();return o.a.createElement(j,{title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"avatar",isOpen:e.isOpen,onClose:e.onClose,buttonTitle:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",onUpdateUser:e.handleUpdateUser,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar(t.current.value)}},o.a.createElement("input",{type:"url",ref:t,className:"popup__input popup__input_link",id:"link-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0,name:"popup-input-link"}),o.a.createElement("div",{className:"popup__input-error",id:"link-input-error"}))},y=a(26),U=function(e){var t=e.component,a=Object(y.a)(e,["component"]);return o.a.createElement(d.b,null,(function(){return a.loggedIn?o.a.createElement(t,a):o.a.createElement(d.a,{to:"/signin"})}))};var P=function(e){var t=o.a.useState(""),a=Object(s.a)(t,2),n=a[0],r=a[1],c=o.a.useState(""),i=Object(s.a)(c,2),u=i[0],l=i[1];return o.a.createElement(j,{title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"add",isOpen:e.isOpen,onClose:e.onClose,buttonTitle:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",onSubmit:function(t){t.preventDefault(),e.onAddPlace({title:n,url:u})}},o.a.createElement("input",{type:"text",onChange:function(e){r(e.target.value)},className:"popup__input popup__input_title",id:"title-input",minLength:"2",maxLength:"30",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0,name:"popup-input-title"}),o.a.createElement("div",{className:"popup__input-error",id:"title-input-error"}),o.a.createElement("input",{type:"url",onChange:function(e){l(e.target.value)},className:"popup__input popup__input_link",id:"link-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0,name:"popup-input-link"}),o.a.createElement("div",{className:"popup__input-error",id:"link-input-error"}))};var R=function(e){var t=e.card?e.card.link:"#",a=e.card?e.card.name:"";return o.a.createElement("div",{className:"popup popup_zoom ".concat(e.card?"popup_opened":"")},o.a.createElement("figure",{className:"popup__figure"},o.a.createElement("button",{className:"popup__close-button",type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}),o.a.createElement("img",{className:"popup__image",src:t,alt:"#"}),o.a.createElement("figcaption",{className:"popup__caption"},a)))},T=a(14),D=a(19);var A=function(e){var t=o.a.useRef(),a=Object(d.g)();return o.a.createElement("div",{ref:t,className:"popup ".concat(e.regStatus?"popup_opened":"")},o.a.createElement("div",{className:"popup__container"},o.a.createElement("button",{className:"popup__close-button",type:"button","aria-label":"\u0437\u0430\u043a\u0440\u044b\u0442\u044c",onClick:function(){t.current.classList.remove("popup_opened"),"success"===e.regStatus&&a.push("/signin"),e.setRegStatus(!1)}}),o.a.createElement("div",{className:"popup__register ".concat(e.regStatus)},o.a.createElement("h2",{className:"popup__header"},"success"===e.regStatus?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."))))};var I=function(e){var t=Object(d.h)(),a=o.a.useState({email:"",password:""}),n=Object(s.a)(a,2),r=n[0],c=n[1],i=function(e){var t=e.target,a=t.name,n=t.value;c((function(e){return Object(D.a)(Object(D.a)({},r),{},Object(T.a)({},a,n))}))};return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"inverted"},o.a.createElement("h2",{className:"popup__header"},"/signup"===t.pathname?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0412\u0445\u043e\u0434"),o.a.createElement("form",{onSubmit:"/signup"===t.pathname?function(a){a.preventDefault(),e.register(t.pathname,"POST",r)}:function(a){a.preventDefault(),e.login(t.pathname,"POST",r),c({email:"",password:""})},className:"popup__form",method:"post",action:"#",noValidate:!0},o.a.createElement("input",{type:"email",placeholder:"Email",onChange:i,className:"popup__input",minLength:"2",maxLength:"40",required:!0,name:"email"}),o.a.createElement("div",{className:"popup__input-error_active",id:"email-input-error"}),o.a.createElement("input",{type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",onChange:i,className:"popup__input",minLength:"2",maxLength:"200",required:!0,name:"password"}),o.a.createElement("div",{className:"popup__input-error_active",id:"password-input-error"}),o.a.createElement("button",{type:"submit",className:"popup__button"},"/signup"===t.pathname?"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f":"\u0412\u0445\u043e\u0434"),"/signup"===t.pathname&&o.a.createElement("div",{className:"popup__register_hint"},"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? ",o.a.createElement(f.b,{className:"popup__register_link",to:"/signin"},"\u0412\u043e\u0439\u0442\u0438")),o.a.createElement("div",{className:"popup__input-error_active inverted",id:"common-input-error"},e.errorMessage))),o.a.createElement(A,{onClose:e.onClose,regStatus:e.regStatus,setRegStatus:e.setRegStatus}))},w=function(e){return o.a.createElement("div",{className:"popup__container_auth"},o.a.createElement(I,{onClose:e.onClose,register:e.register,regStatus:e.regStatus,setRegStatus:e.setRegStatus,errorMessage:e.errorMessage}))},x=function(e){return o.a.createElement("div",{className:"popup__container_auth"},o.a.createElement(I,{handleLogin:e.handleLogin,login:e.login}))};var q=function(){var e=o.a.useState(!1),t=Object(s.a)(e,2),a=t[0],n=t[1],r=o.a.useState(!1),c=Object(s.a)(r,2),u=c[0],p=c[1],h=o.a.useState(null),f=Object(s.a)(h,2),E=f[0],v=f[1],k=o.a.useState(!1),j=Object(s.a)(k,2),y=j[0],T=j[1],D=o.a.useState(""),A=Object(s.a)(D,2),I=A[0],q=A[1],M=o.a.useState({}),J=Object(s.a)(M,2),z=J[0],B=J[1],G=o.a.useState(null),H=Object(s.a)(G,2),V=H[0],F=H[1],K=o.a.useState(!1),Q=Object(s.a)(K,2),W=Q[0],X=Q[1],Y=o.a.useState(!0),Z=Object(s.a)(Y,2),$=Z[0],ee=Z[1],te=o.a.useState({}),ae=Object(s.a)(te,2),ne=ae[0],oe=ae[1],re=o.a.useState(!0),ce=Object(s.a)(re,2),ie=ce[0],se=ce[1],ue=o.a.useState([]),le=Object(s.a)(ue,2),pe=le[0],me=le[1],de=Object(d.g)();o.a.useEffect((function(){C.getCards("/cards").then((function(e){var t=e.map((function(e){return{_id:e._id,link:e.link,name:e.name,likes:e.likes,owner:e.owner}}));me(t)})).catch((function(e){return console.log(e)}))}),[]);var he=function(e){C.deleteCard("/cards/".concat(e._id),"DELETE").then((function(){var t=pe.filter((function(t){return t._id!==e._id}));me(t),fe()})).catch((function(e){return console.log(e)}))};o.a.useEffect((function(){C.getProfile("/users/me").then((function(e){return B(e)})).catch((function(e){return console.log(e)}))}),[]);var fe=function(){n(!1),p(!1),T(!1),v(!1),F(null)},_e=function(e){oe(e),ee(!0),de.push("/")},ge=function(){var e=localStorage.getItem(_);e||ee(!1),N.getData("/users/me",e).then((function(e){if(e){var t={id:e.data._id,email:e.data.email};oe(t),ee(!0)}})).catch((function(e){return console.log(e)}))};return o.a.useEffect((function(){ge()}),[$]),o.a.createElement(l.Provider,{value:z},o.a.createElement(g,{loggedIn:$,userData:ne,setLoggedIn:ee}),o.a.createElement(d.d,null,o.a.createElement(U,{exact:!0,path:"/",loggedIn:$,component:m,onEditAvatar:function(){n(!0)},onEditProfile:function(){p(!0)},onAddPlace:function(){T(!0)},onCardClick:function(e){F(e)},onTrashClick:function(e){v(e)},onCardLike:function(e){var t=e.likes.some((function(e){return e._id===z._id}))?"DELETE":"PUT";C.toggleLike("/cards/likes/".concat(e._id),t).then((function(t){var a=pe.map((function(a){return a._id===e._id?t:a}));me(a)})).then((function(){return se(!1)})).catch((function(e){return console.log(e)}))},onCardDelete:he,cards:pe,setLoader:se,loader:ie}),o.a.createElement(d.b,{path:"/signup"},o.a.createElement(w,{register:function(e,t,a){N.auth(e,t,a).then((function(e){400!==e.statusCode&&q(""),X("success")})).catch((function(e){X("decline"),q(e)}))},regStatus:W,setRegStatus:X,errorMessage:I})),o.a.createElement(d.b,{path:"/signin"},o.a.createElement(x,{handleLogin:_e,login:function(e,t,a){N.auth(e,t,a).then((function(e){var t;e&&q("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a!"),e.token&&(t=e.token,localStorage.setItem(_,t),q(""),_e(e.user))})).catch((function(e){q(e)}))}})),o.a.createElement(m,null,o.a.createElement(O,{isOpen:u,onClose:fe,onUpdateUser:function(e){C.editProfileInfo("/users/me","PATCH",e.name,e.about).then((function(e){B(e),fe()})).catch((function(e){return console.log(e)}))}}),o.a.createElement(L,{isOpen:a,onClose:fe,onUpdateAvatar:function(e){C.setAvatar("/users/me/avatar","PATCH",e).then((function(e){B(e),fe()})).catch((function(e){return console.log(e)}))}}),o.a.createElement(P,{isOpen:y,onClose:fe,onAddPlace:function(e){C.addUserCard("/cards","POST",e.title,e.url).then((function(e){me([e].concat(Object(i.a)(pe))),fe()})).catch((function(e){return console.log(e)}))}}),o.a.createElement(S,{isOpen:E,onClose:fe,onCardDelete:he}),o.a.createElement(R,{card:V,onClose:fe})),o.a.createElement(b,null)))};c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(f.a,null,o.a.createElement(q,null))),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.cb8e42b8.chunk.js.map